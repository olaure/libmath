/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   ft_sin.c                                           :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: olaurent <olaurent@student.42.fr>          +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2016/09/11 13:46:03 by olaurent          #+#    #+#             */
/*   Updated: 2016/09/13 15:29:44 by olaurent         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "ft_math.h"

TT		g_cst[2][33] =
{
	{
		1.0,
		0.0998334166468281523068141984106220269899153880179822599927668615,
		0.1986693307950612154594126271183897503702067295402054039863959913,
		0.2955202066613395751053207456850273736778321117426184485015310361,
		0.3894183423086504916663117567957052645930601834439588951158489658,
		0.4794255386042030002732879352155713880818033679406006751886166131,
		0.5646424733950353572009454456586579071098880849941517710242658942,
		0.6442176872376910536726143513987201830658138445736896447439630880,
		0.7173560908995227616271746105813853661927852377914228209896825206,
		0.7833269096274833884613823157135486231401479257203096035604851525,
		0.8414709848078965066525023216302989996225630607983710656727517099,
		0.8912073600614353399518025778717035383189093194528265276603532917,
		0.9320390859672263496701344354948259954150705882087307353665978944,
		0.9635581854171929647013486300395548153420484913177391179556492230,
		0.9854497299884601806594745788060975173562616723473656319402189456,
		0.9974949866040544309417233711414873227066514259221158219499748240,
		0.9995736030415051643421138255462341719794979147549199553426075158,
		0.9916648104524686153461333986478756524068195711671237253271024910,
		0.9738476308781951865323731788433576067029394713652339556672582591,
		0.9463000876874144884897096116349577621139986655949117644304715527,
		0.9092974268256816953960198659117448427022549714478902683789730115,
		0.8632093666488737706807593132690245849204724248950810769718304594,
		0.8084964038195901843040369104161190651585596059755770790333606087,
		0.7457052121767201773854062116434995389426487780204742575076282805,
		0.6754631805511509265657715253412833742533649578935258422689021286,
		0.5984721441039564940518547021861622717035971715772235733026270326,
		0.5155013718214642352577269352093682438938785877542631212625917300,
		0.4273798802338299345560530858578806474964764226667025649901777607,
		0.3349881501559049195438537527124221060303065288835867106841010730,
		0.2392493292139823281842569187395753722155529302996187741162102658,
		0.1411200080598672221007448028081102798469332642522655841518826412,
		0.0415806624332905791946982715966731005546134229638067506480090007,
		-0.0583741434275799091372174146190951851251250990829265697093502542
	},
	{
		0.0,
		0.9950041652780257660955619878038702948385762254150840359593527446,
		0.9800665778412416311241965167481688773935243608065679940525482901,
		0.9553364891256060196423102275680498982442140826320376745176136122,
		0.9210609940028850827985267320518016140258595693198504456150892671,
		0.8775825618903727161162815826038296519916451971097440529976108683,
		0.8253356149096782972409524989553760388780910391884703813697497736,
		0.7648421872844884262558599901918649092682105503737033560729324582,
		0.6967067093471654209207499816423249261017860137080607836371448941,
		0.6216099682706644564847161514071335087217613665912390075763834845,
		0.5403023058681397174009366074429766037323104206179222276700972553,
		0.4535961214255773877713700517847161221214672956625950474559380554,
		0.3623577544766735776383733556230760203399477855766486264877497209,
		0.2674988286245874069979841092928713592759299216791296619172533674,
		0.1699671429002409386167480352036498029281839210285343089823652114,
		0.0707372016677029100881898514342687090850910275633468694226454171,
		-0.0291995223012887262057704629464985244448647210938469450031300790,
		-0.1288444942955246840876428573348735141016400796452029763317821399,
		-0.2272020946930870553166743065305807324769515865382610715849691110,
		-0.3232895668635034222788336950803101745941907654422395999011543650,
		-0.4161468365471423869975682295007621897660007710755448907551499737,
		-0.5048461045998574516209385237191674704070233767413620596481962235,
		-0.5885011172553457085241426126549284162937603666987279897475351740,
		-0.6662760212798241933178805711660172301632753710037698886526695718,
		-0.7373937155412454996088222273347829084330128919922847987843656887,
		-0.8011436155469337148335027904673516644285678487678201350745979916,
		-0.8568887533689472337977021516452011123539226382332440491050124271,
		-0.9040721420170611479825272819433301263318497351636247110412669486,
		-0.9422223406686581525867881173661540124634142344682466201809820199,
		-0.9709581651495905217811066693455321791176147594242395421386709924,
		-0.9899924966004454572715727947312613023936790966155883288140859329,
		-0.9991351502732794644923760545414662628366416699479427435447159825,
		-0.9982947757947530846616607222835826914470125859516601675950800204
	}
};

TT		ft_closest(TT x)
{
	int		i;
	int		n;
	TT		red;

	if (x < 0)
		return (-1 * ft_closest(-x));
	red = x;
	while (red > PI)
		red -= PI;
	n = (int)(PI / ANG_DELTA) + 1;
	i = -1;
	while (++i < n)
		if (red < ANG_DELTA * i + ANG_DELTA_2)
			return (i);
	return (n);
}

TT		ft_pol_elem(TT x, int p)
{
	TT		r;

	r = 1;
	while (p > 0)
		r *= x / p--;
	return (r);
}

/*
** f(x) = f(y) + f'(y) (x - y) + f''(y) (x-y)^2 / 2 + f'''(y) (x -y)^3 / 3! + ..
*/

TT		ft_sin_pol(TT x)
{
	TT		res;
	int		c;
	int		i;
	TT		d;

	c = ft_closest(x);
	d = x - ANG_DELTA * (TT)c;
	res = g_cst[0][c];
	i = 0;
	while (i++ < SIN_PREC)
	{
		if ((i % 4) > 1)
			res -= g_cst[i % 2][c] * ft_pol_elem(d, i);
		else
			res += g_cst[i % 2][c] * ft_pol_elem(d, i);
	}
	return (res);
}

TT		ft_sin(TT x)
{
	while (x > PI)
		x -= PI_2;
	while (x < -PI)
		x += PI_2;
	return (x < 0 ? -ft_sin_pol(-x) : ft_sin_pol(x));
}

TT		ft_cos(TT x)
{
	return (ft_sin(x + PI / 2.0));
}
